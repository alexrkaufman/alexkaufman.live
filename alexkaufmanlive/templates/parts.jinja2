{%- macro show_list(shows) -%}
<ul class="show-list">
{%- if not shows -%}
    <p>
        No upcoming shows right now.
        <a href="mailto:alexkaufmancomedy@gmail.com">
            Reach out and change that.
        </a>
    </p>
{%- endif -%}
{%- for show in shows -%}
    <li>
    <article class="show on-list">
        <h2 class="show-title">
            <a href="{{ url_for('shows.show', show_slug=show.link) }}">
                {{ show.title }}
            </a>
        </h2>
        <div class="show-meta">
            <div class="location">
            {%- if show.meta -%}
                {{ show["meta"]["city"] }}, {{ show["meta"]["state"]}}
            {%- endif -%}
            </div>
            <time class="show-date">{{ show["show_date"] }}</time>
        </div>
    </article>
    </li>
{%- endfor -%}
</ul>
{%- endmacro %}

{% macro eventbrite_button(event_id) -%}
<button id="event-button" type="button">buy tickets</button>

<script src="https://www.eventbrite.com/static/widgets/eb_widgets.js"></script>

<script type="text/javascript">
    var exampleCallback = function () {
        console.log('Order complete!');
    };

    window.EBWidgets.createWidget({
        widgetType: 'checkout',
        eventId: '{{event_id}}',
        modal: true,
        modalTriggerElementId: 'event-button',
        onOrderComplete: exampleCallback,
    });
</script>
{%- endmacro %}

{% macro tickettailor_button(event_id, box_office_name) -%}
<script src="https://cdn.tickettailor.com/js/TTWidget.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    var ticketButton = document.getElementById('ticketButton');
    if (ticketButton) {
        ticketButton.addEventListener('click', function() {
            var eventId = '{{ event_id }}'; // Ensure this binding pulls the correct ID
            TTWidget.loadEvent('{{ box_office_name }}', eventId);
        });
    }
});

</script>

<button id="ticketButton" type="button">buy tickets</button>
{%- endmacro %}

{% macro event_button(event_link) -%}
<a href="{{ event_link }}"><button id="event-button" type="button">buy tickets</button></a>
{%- endmacro %}


{% macro email_list_cta(tags) -%}
<button type="button" id="email-signup-button">join my email list</button>

<div id="email-modal" class="modal">
  <div class="modal-content">
    <h3>join my email list</h3>
    <form id="email-form">
      <label for="modal-email">Enter your email</label>
      <input type="email" name="email" id="modal-email" required />
      <div class="modal-buttons">
        <button type="button" id="email-modal-close">cancel</button>
        <button type="submit" id="email-submit">join</button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const button = document.getElementById('email-signup-button');
  const modal = document.getElementById('email-modal');
  const closeButton = document.getElementById('email-modal-close');
  const form = document.getElementById('email-form');

  button.addEventListener('click', function() {
    modal.style.display = 'block';
  });

  closeButton.addEventListener('click', function() {
    modal.style.display = 'none';
  });

  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(form);

    fetch('{{ url_for("main.email_subscribe") }}', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.querySelector('.modal-content').innerHTML = '<h3>Success!</h3><p>' + data.message + '</p><div class="modal-buttons"><button type="button" id="email-modal-close">close</button></div>';
        document.getElementById('email-modal-close').addEventListener('click', function() {
          modal.style.display = 'none';
          location.reload();
        });
      } else {
        document.querySelector('.modal-content').innerHTML = '<h3>Error</h3><p>' + (data.error || 'Error subscribing. Please try again.') + '</p><div class="modal-buttons"><button type="button" id="email-modal-close">try again</button></div>';
        document.getElementById('email-modal-close').addEventListener('click', function() {
          location.reload();
        });
      }
    })
    .catch(error => {
      document.querySelector('.modal-content').innerHTML = '<h3>Error</h3><p>Error subscribing. Please try again.</p><div class="modal-buttons"><button type="button" id="email-modal-close">try again</button></div>';
      document.getElementById('email-modal-close').addEventListener('click', function() {
        location.reload();
      });
    });
  });
});
</script>
{%- endmacro %}
